<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Assignment 8 ‚Äì Neelesh</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <h1>‚ú® Assignment 8 ‚Äì Neelesh (CT_CSI_NJ_5765)</h1>

  <!-- üîê Login -->
  <div class="card">
    <h2>Login</h2>
    <form id="loginForm">
      <input type="text" id="username" placeholder="Username" required />
      <input type="password" id="password" placeholder="Password" required />
      <button type="submit">Login</button>
    </form>
    <div id="loginResult" class="result"></div>
  </div>

  <!-- üõ°Ô∏è Protected API -->
  <div class="card">
    <h2>Protected Data Access</h2>
    <button id="protectedBtn">Get Protected Info</button>
    <div id="protectedResult" class="result"></div>
  </div>

  <!-- üìÅ File Upload -->
  <div class="card">
    <h2>Upload File</h2>
    <form id="uploadForm" enctype="multipart/form-data">
      <input type="file" name="file" required />
      <button type="submit">Upload File</button>
    </form>
    <div id="uploadResult" class="result"></div>
  </div>

  <!-- ‚òÅÔ∏è Weather -->
  <div class="card">
    <h2>Check Weather</h2>
    <form id="weatherForm">
      <input type="text" id="cityInput" placeholder="Enter City (e.g., Delhi)" required />
      <button type="submit">Get Weather</button>
    </form>
    <div id="weatherResult" class="result"></div>
  </div>

  <!-- üí° JavaScript -->
  <script>
    let token = '';

    const loginResult = document.getElementById('loginResult');
    const protectedResult = document.getElementById('protectedResult');
    const uploadResult = document.getElementById('uploadResult');
    const weatherResult = document.getElementById('weatherResult');

    function showResult(el, message, isSuccess = true) {
      el.innerText = message;
      el.className = `result ${isSuccess ? 'success' : 'error'}`;
    }

    // üîê LOGIN
    document.getElementById('loginForm').addEventListener('submit', async function (e) {
      e.preventDefault();
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;

      const res = await fetch('/auth/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, password }),
      });

      const data = await res.json();
      if (data.token) {
        token = data.token;
        showResult(loginResult, '‚úÖ Login Successful!', true);
      } else {
        showResult(loginResult, data.message || 'Login failed.', false);
      }
    });

    // üîí PROTECTED ROUTE
    document.getElementById('protectedBtn').addEventListener('click', async function () {
      const res = await fetch('/auth/protected', {
        headers: { Authorization: `Bearer ${token}` },
      });

      const data = await res.json();
      showResult(protectedResult, JSON.stringify(data), res.ok);
    });

    // üìÅ FILE UPLOAD
    document.getElementById('uploadForm').addEventListener('submit', async function (e) {
      e.preventDefault();
      const formData = new FormData(this);

      const res = await fetch('/upload', {
        method: 'POST',
        body: formData,
      });

      const data = await res.json();
      showResult(uploadResult, data.message || JSON.stringify(data), res.ok);
    });

    // üå¶Ô∏è WEATHER
    document.getElementById('weatherForm').addEventListener('submit', async function (e) {
      e.preventDefault();
      const city = document.getElementById('cityInput').value;

      const res = await fetch(`/weather?city=${city}`);
      const data = await res.json();

      showResult(weatherResult, data.message || JSON.stringify(data), res.ok);
    });
  </script>
</body>
</html>
